# mise.toml - OpenClaw DEV TaskBoard
# Manages tools, environment, and tasks for development workflow
# https://mise.jdx.dev/configuration.html

min_version = "2026.1.0"

[env]
PROJECT_NAME = "openclawdev-taskboard"
PYTHONUNBUFFERED = "1"

# Automatically create and activate venv using uv
_.python.venv = { path = ".venv", create = true }
UV_LINK_MODE = "copy"

[tools]
# Core runtime
python = "3.12"
uv = "latest"

# Linting & formatting
ruff = "latest"

# Git hooks (hk requires pkl)
hk = "latest"
pkl = "latest"

# =============================================================================
# TASKS
# =============================================================================

[tasks.install]
description = "Install Python dependencies"
alias = "i"
run = "uv sync"

[tasks.dev]
description = "Run development server with hot reload"
alias = "d"
run = "uv run uvicorn app:app --host 0.0.0.0 --port 8080 --reload"

[tasks.lint]
description = "Run linter (check only)"
alias = "l"
run = "uv run ruff check app.py"

[tasks.lint-fix]
description = "Run linter with auto-fix"
run = "uv run ruff check --fix app.py"

[tasks.format]
description = "Format code"
alias = "f"
run = "uv run ruff format app.py"

[tasks.format-check]
description = "Check code formatting"
run = "uv run ruff format --check app.py"

[tasks.check]
description = "Run all quality checks"
depends = ["lint", "format-check"]

[tasks.fix]
description = "Fix all auto-fixable issues"
depends = ["lint-fix", "format"]

[tasks.build]
description = "Build Docker image"
alias = "b"
run = "docker build -t openclaw-dev-taskboard ."

[tasks.up]
description = "Start services with docker-compose"
run = "docker-compose up -d"

[tasks.down]
description = "Stop services"
run = "docker-compose down"

[tasks.logs]
description = "View container logs"
run = "docker-compose logs -f taskboard"

[tasks.test]
description = "Run tests"
alias = "t"
run = "uv run pytest"

[tasks.ci]
description = "Run full CI pipeline"
depends = ["check", "test", "build"]

[tasks.pre-commit]
description = "Pre-commit hook (called by hk)"
run = "hk run pre-commit"

[tasks.hk-check]
description = "Run hk checks on all files"
run = "hk check --all"

[tasks.hk-fix]
description = "Run hk fixes on all files"
run = "hk fix --all"

[tasks."git:hooks:install"]
description = "Install git hooks (run manually, not on enter)"
run = "hk install --mise"

# =============================================================================
# HOOKS
# =============================================================================
# Note: hk hooks should be installed manually with 'mise run git:hooks:install'
# to prevent reinstallation from overwriting customized hooks
#
# REMOVED: [hooks] enter = "mise install -q" - this caused repeated tool
# installations on every terminal open and potential crashes
